[–î–º–∏—Ç—Ä–∏–π –ö—É–∑—å–º–∏–Ω. –ò–Ω–∂–µ–Ω–µ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö](https://t.me/kuzmin_dmitry91/32)

–û—á–µ—Ä–µ–¥–Ω–æ–π —Ä–∞–±–æ—á–∏–π –∫–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–º —è —Ö–æ—á—É –ø–æ–¥–µ–ª–∏—Ç—å—Å—è.

–î–æ —ç—Ç–æ–≥–æ –Ω–µ –æ–±—Ä–∞—â–∞–ª –≤–Ω–∏–º–∞–Ω–∏–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –ê —Ä–µ—á—å –∑–¥–µ—Å—å –ø—Ä–æ –ª—é–±–æ—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, –±—É–¥—å —Ç–æ SQL, Spark –∏–ª–∏ –∏–Ω—ã–µ ETL jobs.

–ü–æ–¥ —Ñ–∏–ª—å—Ä–∞—Ü–∏–µ–π —è –∏–º–µ—é –≤–≤–∏–¥—É –ª—é–±—ã–µ Transform actions, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –Ω–∞ —Ä–∞–Ω–Ω–µ–π —Å—Ç–∞–¥–∏–∏ –æ—Ç–±—Ä–æ—Å–∏—Ç—å –ª–∏—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å (–∫—Ä–∞—Ç–Ω–æ) –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.

### –ó–∞–¥–∞—á–∞

*–ü–∏—à—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ –∏ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ —Ä–∞–±–æ—á–∏–π –∫–µ–π—Å.*

–ï—Å—Ç—å –Ω–µ–∫–∏–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º, —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å.

**–ó–∞–¥–∞—á–∞** –¥–æ –±–æ–ª–∏ –∑–Ω–∞–∫–æ–º–∞—è –≤—Å–µ–º –∏–Ω–∂–µ–Ω–µ—Ä–∞–º - –Ω–∞ —ç—Ç–æ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø—Ä–∏–∫–ª–µ–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–≤—É—Ö –¥—Ä—É–≥–∏—Ö –æ–≥—Ä–æ–º–Ω–µ–π—à–∏—Ö —Ç–∞–±–ª–∏—Ü. 

–ü–æ—Ä—Ç—Ñ–µ–ª—å –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å df1 –∏ df2 –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –º–∞–ª.

| **–ù–∞–∑–≤–∞–Ω–∏–µ** | **–û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ** | **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å, —Å—Ç—Ä–æ–∫–∏** |
| --- | --- | --- |
| –ü–æ—Ä—Ç—Ñ–µ–ª—å  | portf | 4.7 –º–ª–Ω |
| –¢–∞–±–ª–∏—Ü–∞ 1 | df1 | 128 –º–ª—Ä–¥ |
| –¢–∞–±–ª–∏—Ü–∞ 2 | df2 | 150 –º–ª—Ä–¥ |

### –†–µ—à–µ–Ω–∏–µ ‚Äú–≤ –ª–æ–±‚Äù

![1.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/4f7c3174-5a9b-4b45-b7b7-59ecea8d9de0/108cbf8b-2556-4817-81e8-7b6cba587a99/1.jpg)

–ù–∞—á–∞–ª —è –¥–µ–ª–∞—Ç—å, –Ω–∞–≤–µ—Ä–Ω–æ, –∫–∞–∫ –¥–µ–ª–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∞–¥–µ–∫–≤–∞—Ç–Ω—ã—Ö –ª—é–¥–µ–π - –∫ –ø–æ—Ä—Ç—Ñ–µ–ª—é –ª–µ–≤—ã–º join –ø—Ä–∏–∫–ª–µ–∏–≤–∞—é –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ df1 –∏ df2.

```sql
(
	spark.sql("""
		select *
		from portf
			left join df1 using(id)
			left join df2 using(id)
	""")
)
```

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∏–∑ df1 / df2 –∫ –ø–æ—Ä—Ç—Ñ–µ–ª—é –ø—Ä–∏–∫–ª–µ—è—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ –¥–∞–Ω–Ω—ã–µ, –∫–ª—é—á–∏ –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –≤ —ç—Ç–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.

–ù–æ –≤—Å—è –ø—Ä–æ–±–ª–µ–º–∞ –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü df1 / df2.

–ö–∞–∫ –∏—Ç–æ–≥, —è –ø—Ä–æ–∂–¥–∞–ª –æ–∫–æ–ª–æ 4 —á–∞—Å–æ–≤, –∞ –ø–æ—Ç–æ–º –∑–∞–ø—Ä–æ—Å —É–ø–∞–ª –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º.

### –†–µ—à–µ–Ω–∏–µ ‚Äú–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è‚Äù

–ï—Å—Ç—å –∏–Ω–æ–π –ø–æ–¥—Ö–æ–¥ - –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–≤–µ–¥–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, –Ω–æ ‚Äú–≤–≤–µ—Ä—Ö –Ω–æ–≥–∞–º–∏‚Äù, —Ç–æ –µ—Å—Ç—å –∏–∑ —ç—Ç–∏—Ö –æ–≥—Ä–æ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü —Å—Ä–∞–∑—É –æ—Ç–±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –Ω–∞—Å –∑–∞–ø–∏—Å–∏, –∫–ª—é—á–∏ –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ.

![2.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/4f7c3174-5a9b-4b45-b7b7-59ecea8d9de0/64ae0da8-9de7-4ec1-9d04-ba26e27fd4a9/2.jpg)

```sql
df1_new = (
	spark.sql("""
		select *
		from df1
			join portf using(id)
	""")
)

df2_new = (
	spark.sql("""
		select *
		from df2
			join portf using(id)
	""")
)
```

–¢–æ –µ—Å—Ç—å –∏–∑ –∫–∞–∂–¥–æ–π –±–æ–ª—å—à–æ–π —Ç–∞–±–ª–∏—Ü—ã –º—ã –≤—ã–±–∏—Ä–∞–µ–º —Å—Ä–∞–∑—É —Ç–æ–ª—å–∫–æ —Ç–µ –∑–∞–ø–∏—Å–∏, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –∫–ª—é—á–∏ –∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è (–ø–æ—Ä—Ç—Ñ–µ–ª—å –¥–µ–ª–∏—Ç—Å—è —Ç–∞–∫–∂–µ –Ω–∞ 2 –Ω–µ—Ä–∞–≤–Ω—ã—Ö –∫—É—Å–æ—á–∫–∞ –∏ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ join —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ–π).

–ê –∑–∞—Ç–µ–º –∫ –ø–æ—Ä—Ç—Ñ–µ–ª—é –ø—Ä–∏–∫–ª–µ–∏–≤–∞–µ–º —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

```sql
(
	spark.sql("""
		select *
		from portf
			left join df1_new using(id)
			left join df2_new using(id)
	""")
)
```

![3.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/4f7c3174-5a9b-4b45-b7b7-59ecea8d9de0/e74ebb9f-5234-441d-a793-c4976f3df351/3.jpg)

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–µ—Ç–æ–¥–∞

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç

- –∫—Ä–∞—Ç–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞—Å—á–µ—Ç–æ–≤
- –∏–∑–±–µ–∂–∞—Ç—å –ø–∞–¥–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º

### –†–µ–∑—é–º–µ

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω—É–∂–Ω–∞ –Ω–µ –≤—Å–µ–≥–¥–∞. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è, –ª–µ–Ω—å - –¥–≤–∏–≥–∞—Ç–µ–ª—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞. 

–ö–∞–∫ –≤ –ª—é–±–æ–π –∑–∞–¥–∞—á–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–¥–µ–ª–∞—Ç—å –≤ –ª–æ–±. –í–æ–∑–º–æ–∂–Ω–æ, –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞ —É—Å—Ç—Ä–æ–∏—Ç –≤–µ—Ä—Å–∏—è 1 –≤–∞—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è. –î–æ–∫—Ä—É—á–∏–≤–∞—Ç—å –≤—ã –≤—Å–µ–≥–¥–∞ —É—Å–ø–µ–µ—Ç–µ, –≥–ª–∞–≤–Ω–æ–µ - –≤—ã–ø–æ–ª–Ω–∏—Ç—å.

–ù–æ –µ—Å–ª–∏ –≤–∞—à–∞ –∑–∞–¥–∞—á–∞, –∫–∞–∫ –∏ –≤ –º–æ–µ–º —Å–ª—É—á–∞–µ, –Ω–µ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ø–∞–¥–∞–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Ä–µ—Å—É—Ä—Å–∞–º, —Ç–æ –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö.

–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ, –Ω–∞–¥–µ—é—Å—å –≤–∞–º –±—ã–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∏ –ø–æ–ª–µ–∑–Ω–æ üôÇ